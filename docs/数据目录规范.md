# 数据目录规范

## 目录结构

```
图谱数据/
├── 高中物理-v3/
│   ├── entities/
│   │   ├── Chapter.json
│   │   ├── Section.json
│   │   └── ...
│   └── relations/
│       ├── Chapter_Section.json
│       └── ...
├── 义教生物-v4/
│   ├── entities/
│   └── relations/
└── ...
```

## 命名规范

### 目录命名

1. **学科目录格式**: `学科名称-v版本号`
   - 正确: `高中物理-v3`, `义教生物-v4`
   - 错误: `高中物理_v3`, `义教生物v4`

2. **子目录命名**: 使用英文小写
   - 实体目录: `entities`
   - 关系目录: `relations`

### 文件命名

1. **实体文件**: 使用PascalCase，如 `Chapter.json`, `Section.json`
2. **关系文件**: 使用下划线连接，如 `Chapter_Section.json`
3. **避免特殊字符**: 不要使用中文、空格、特殊符号

### 常见拼写错误

以下拼写错误会被自动纠正：
- `entitles` → `entities`
- `CourseMoudle` → `CourseModule`
- `Promblem` → `Problem`

## JSON文件格式

### 实体文件 (`entities/*.json`)

使用数组格式：

```json
[
  {
    "identifier": "unique_id_001",
    "title": "实体标题",
    "description": "描述信息"
  },
  ...
]
```

### 关系文件 (`relations/*.json`)

使用数组格式：

```json
[
  {
    "source": "source_entity_id",
    "target": "target_entity_id",
    "relationName": "has_part"
  },
  ...
]
```

**注意**: 系统同时支持以下对象包装格式（向后兼容），但新数据建议使用数组格式：

```json
{
  "entities": [...],
  "relations": [...]
}
```

## 数据规范化工具

使用 `scripts/normalize_data_dirs.py` 工具自动检查和修复问题：

```bash
# 检查模式（只报告问题，不修改）
python scripts/normalize_data_dirs.py --check

# 修复模式（自动修复问题）
python scripts/normalize_data_dirs.py --fix
```

该工具会：
- 统一版本号格式（`_v` → `-v`）
- 修复目录/文件名拼写错误
- 清理系统文件（`.DS_Store`）
- 检查双重扩展名问题

## 版本管理

1. 每次数据更新创建新版本目录，保留旧版本
2. 系统会自动检测最新版本
3. 可通过 "系统管理 → 刷新配置" 热加载新版本

## 最佳实践

1. 数据提交前运行规范化检查
2. 保持实体ID的唯一性和稳定性
3. 关系文件中的source/target必须是有效的实体ID
4. 避免在文件名中使用特殊字符
