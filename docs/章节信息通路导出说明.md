# 章节信息通路导出说明

## 设计思路

### 审核目标
1. 检查从教材章节到课标内容的映射是否完整
2. 检查知识体系的逻辑关系是否正确
3. 检查核心素养的培养是否覆盖到位

### 为什么采用分层设计？

**问题背景**：
- 图谱是网状结构，一个章节可能关联多个节、小节、内容要点等
- 如果把所有关联都放在一行，无法看出具体的路径关系
- 审核时需要知道"哪个小节对应哪个内容要点"、"哪个内容要点属于哪个单元"

**分层设计方案**：
将知识图谱分为4个层面导出，每个层面一个sheet，方便分别审核。

## 输出文件结构

### Sheet 1: 教材结构概览（推荐）⭐

**用途**：快速浏览教材结构和课标映射

**数据结构**：每一行表示一个 `小节 -> 内容要点 -> 单元 -> 主题 -> 主线` 的映射路径

| 列名 | 说明 | 示例 |
|------|------|------|
| 章 | 教材章名称 | "第一章 集合与常用逻辑用语" |
| 节 | 教材节名称 | "1.1 集合" |
| 小节 | 教材小节名称 | "1.1.1 集合及其表示方法" |
| 内容要点 | 课标内容要点 | "集合的概念与表示" |
| 单元 | 课标单元 | "集合" |
| 主题 | 课标主题 | "预备知识" |
| 主线 | 课标主线/领域 | "函数" |
| 核心素养数量 | 该单元培养的核心素养数 | 12 |

**审核要点**：
- 每个小节是否都有对应的内容要点？
- 每个内容要点是否映射到正确的单元？
- 单元的主题和主线归属是否正确？

**记录数**：约 167 条（高中数学）

---

### Sheet 2: 课标关联表

**用途**：检查核心素养的覆盖情况

**数据结构**：每一行表示一个 `单元 -> 核心素养 -> 学业质量` 的关联路径

| 列名 | 说明 | 示例 |
|------|------|------|
| 单元 | 课标单元名称 | "集合" |
| 单元说明 | 单元的描述 | "本单元的学习，可以帮助..." |
| 主题 | 单元所属主题 | "预备知识" |
| 主线 | 主题所属主线 | "函数" |
| 核心素养 | 核心素养名称 | "数学抽象" |
| 核心素养说明 | 核心素养的描述 | "数学抽象是指..." |
| 学业质量等级 | 学业质量等级 | "学业质量" |

**审核要点**：
- 每个单元是否都培养了相应的核心素养？
- 核心素养的覆盖是否全面？
- 学业质量等级的划分是否合理？

**记录数**：约 2394 条（高中数学）
- 19个必修单元 × 平均12个核心素养 × 3个学业质量等级 ≈ 684条
- 加上不同主题和主线的组合

---

### Sheet 3: 完整路径表

**用途**：审核完整的信息通路（从教材到学业质量的全链路）

**数据结构**：每一行表示一条完整的信息通路

| 列名 | 说明 |
|------|------|
| 章 | 教材章名称 |
| 节 | 教材节名称 |
| 小节 | 教材小节名称 |
| 内容要点 | 课标内容要点 |
| 单元 | 课标单元 |
| 主题 | 课标主题 |
| 主线 | 课标主线/领域 |
| 核心素养 | 核心素养名称 |
| 学业质量等级 | 学业质量等级 |
| 章ID, 节ID, ... | 各节点的identifier |

**路径示例**：
```
第一章 集合与常用逻辑用语 -> 1.1 集合 -> 1.1.1 集合及其表示方法 
-> 集合的概念与表示 -> 集合单元 -> 预备知识主题 -> 函数主线 
-> 数学抽象素养 -> 学业质量水平2
```

**审核要点**：
- 检查完整的信息通路是否合理
- 检查是否有断裂的路径（缺少某个环节）
- 检查不同路径之间是否有冲突或重复

**记录数**：约 4707 条（高中数学）

---

### Sheet 4: 教材映射明细

**用途**：详细的教材到课标的映射关系（含所有ID字段）

**数据结构**：与Sheet 1类似，但包含所有identifier字段，便于追溯和排查

**审核要点**：
- 用于排查具体的映射问题
- 通过ID字段可以追溯到原始数据

**记录数**：约 167 条（高中数学）

---

## 使用方法

### 基本用法

```bash
# 导出高中数学
python3 cypher_queries/导出章节信息通路_分层.py

# 预览数据结构（不导出）
python3 cypher_queries/导出章节信息通路_分层.py --preview

# 查看特定章节详情
python3 cypher_queries/导出章节信息通路_分层.py --preview --detail "第一章 集合与常用逻辑用语"

# 指定输出文件
python3 cypher_queries/导出章节信息通路_分层.py -o 审核数据/高中数学_信息通路.xlsx

# 导出其他学科
python3 cypher_queries/导出章节信息通路_分层.py --subject GaoZhongWuLi
```

### 参数说明

- `--subject`: 学科标签（默认: GaoZhongShuXue）
- `--output, -o`: 输出文件路径
- `--preview`: 仅预览数据结构，不导出
- `--detail`: 显示指定章节的详细信息
- `--all-details`: 显示所有章节的详细信息

## 审核建议

### 第一步：教材结构审核（Sheet 1）

1. **完整性检查**
   - 每个章是否都有对应的节？
   - 每个节是否都有对应的小节？
   - 每个小节是否都有对应的内容要点？

2. **准确性检查**
   - 小节名称是否与教材一致？
   - 内容要点是否准确对应该小节的内容？
   - 内容要点是否映射到了正确的单元？

3. **一致性检查**
   - 同一单元的内容要点是否在逻辑上一致？
   - 单元的主题和主线归属是否合理？

### 第二步：课标关联审核（Sheet 2）

1. **核心素养覆盖检查**
   - 每个单元是否都培养了相应的核心素养？
   - 6大核心素养（数学抽象、逻辑推理、数学运算、直观想象、数学建模、数据分析）是否都有覆盖？

2. **学业质量检查**
   - 每个核心素养是否都关联到了学业质量等级？
   - 学业质量等级的划分是否合理？

### 第三步：完整路径审核（Sheet 3）

1. **路径完整性检查**
   - 从教材到学业质量的路径是否完整？
   - 是否有断裂的路径？

2. **路径合理性检查**
   - 同一教材内容是否关联到了多个核心素养？（这是正常的）
   - 不同路径之间是否有逻辑冲突？

## Excel审核技巧

### 使用筛选和排序

1. **筛选特定章节**
   - 选中表头行
   - 点击"数据" -> "筛选"
   - 在"章"列筛选特定章节

2. **按单元分组查看**
   - 按"单元"列排序
   - 可以看到每个单元包含的所有内容要点

3. **检查缺失**
   - 筛选"单元"列为空的行
   - 筛选"核心素养"列为空的行

### 使用数据透视表

可以创建数据透视表来统计：
- 每个章有多少个路径
- 每个单元培养了多少个核心素养
- 每个核心素养覆盖了多少个单元

### 对比审核

1. **横向对比**：同一章的不同节/小节之间的内容是否一致
2. **纵向对比**：不同章节是否都遵循相同的映射规则
3. **交叉对比**：教材结构与课标结构是否匹配

## 常见问题

### Q1: 为什么有些记录显示为空？
A: 某些节点可能没有关联到后续节点。例如：
- 某些小节可能没有对应的内容要点（需要补充）
- 某些单元可能没有明确的主题归属（数据问题）

### Q2: 为什么课标关联表的记录数这么多？
A: 因为一个单元通常培养多个核心素养（平均12个），每个核心素养关联多个学业质量等级，所以会产生笛卡尔积效应。

### Q3: 如何快速找到某个教材章节对应的核心素养？
A: 
1. 在【1-教材结构概览】中筛选特定章节
2. 记录该章节的"单元"列表
3. 在【2-课标关联表】中筛选这些单元
4. 即可看到对应的核心素养

### Q4: 为什么有些路径看起来不合理？
A: 可能是数据问题，例如：
- 关系文件中的identifier不匹配
- 某些关系方向错误
- 某些节点缺失
可以使用 `json2csv.py` 生成的缺失节点日志排查问题。

## 数据统计（高中数学）

| Sheet | 记录数 | 说明 |
|-------|--------|------|
| 1-教材结构概览 | 167 | 小节到单元的映射 |
| 2-课标关联表 | 2394 | 单元到核心素养到学业质量 |
| 3-完整路径表 | 4707 | 完整的信息通路 |
| 4-教材映射明细 | 167 | 详细映射（含ID） |

## 相关工具

- `json2csv.py`: 导出实体和关系数据
- `查询章节信息通路.py`: 原版导出工具（汇总格式）
- `导出章节信息通路_分层.py`: 分层导出工具（推荐）⭐

## 更新日志

- v1.0.0 (2026-01-22)
  - 初始版本
  - 采用分层设计，便于审核
  - 支持4种不同粒度的导出
