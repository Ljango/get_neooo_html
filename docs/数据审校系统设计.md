# 数据审校系统设计文档

## 一、系统概述

### 1.1 背景

知识图谱数据来源于多个渠道，格式和质量参差不齐。为了确保数据准确性，需要学科教师参与审校，验证实体属性和关系的正确性。

### 1.2 目标

让学科教师能够：
1. **审核实体属性**：检查名称、描述、分类是否正确
2. **审核关系正确性**：检查两个实体之间的关联是否合理
3. **提交修改建议**：标记问题并提出修正意见
4. **追踪版本变化**：了解数据的修改历史

### 1.3 数据规模

| 指标 | 数值 |
|-----|------|
| 学科数量 | 18个 |
| 总实体数 | 6,083个 |
| 总关系数 | 24,207条 |
| 平均每学科实体 | 338个 |
| 实体类型总数 | ~50种 |

## 二、界面布局设计

### 2.1 整体布局

```
┌─────────────────────────────────────────────────────────────┐
│  知识图谱数据审校平台                    [学科] [版本] [登录] │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────────────────────────────┐   │
│  │ 导航面板     │  │ 主工作区                             │   │
│  │             │  │                                     │   │
│  │ □ 实体审核   │  │  ┌─────────────────────────────┐   │   │
│  │   ├ 课程模块  │  │  │ 图谱可视化区域              │   │   │
│  │   ├ 核心素养  │  │  │ （D3.js交互图）             │   │   │
│  │   ├ 章节     │  │  │ - 点击节点查看详情          │   │   │
│  │   └ ...     │  │  │ - 拖拽调整布局              │   │   │
│  │             │  │  └─────────────────────────────┘   │   │
│  │ □ 关系审核   │  │                                     │   │
│  │   ├ 章-节    │  │  ┌─────────────────────────────┐   │   │
│  │   ├ 节-知识点 │  │  │ 详情/编辑面板               │   │   │
│  │   └ ...     │  │  │ - 选中节点属性              │   │   │
│  │             │  │  │ - 关联关系列表              │   │   │
│  │ □ 审核进度   │  │  │ - 审核状态/批注              │   │   │
│  │   ├ 待审核   │  │  │ - 修改建议提交              │   │   │
│  │   ├ 已通过   │  │  └─────────────────────────────┘   │   │
│  │   └ 有问题   │  │                                     │   │
│  └─────────────┘  └─────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│  状态栏: 高中数学-v1 | 实体:403 关系:2746 | 待审核:156      │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 主要页面

#### 页面1：实体审核列表

| 序号 | 类型 | 名称 | 状态 | 操作 |
|-----|------|-----|------|-----|
| 1 | Chapter | 第一章 集合与常用逻辑用语 | 待审核 | [查看] [通过] [标记问题] |
| 2 | Chapter | 第二章 等式与不等式 | 已通过 | [查看] |
| 3 | Section | 1.1 集合的概念 | 有问题 | [查看] [查看批注] |

#### 页面2：关系审核列表

| 序号 | 关系类型 | 源实体 | 目标实体 | 状态 | 操作 |
|-----|---------|-------|---------|------|-----|
| 1 | 包含节 | 第一章 集合... | 1.1 集合的概念 | 待审核 | [通过] [标记问题] |
| 2 | 关联核心素养 | 第一章... | 数学抽象 | 待审核 | [通过] [标记问题] |

#### 页面3：审核详情

```
┌─────────────────────────────────────────────┐
│ 实体详情                           [关闭]    │
├─────────────────────────────────────────────┤
│ 类型: Chapter                               │
│ 名称: 第一章 集合与常用逻辑用语              │
│ identifier: urn:jy:math:SB0201:OB06:Ch...   │
│                                             │
│ 扩展属性:                                    │
│   - 学期: 高中                               │
│   - 版本: 人教版（B版）                       │
│   - 册次: 必修 第一册                         │
│                                             │
│ 关联关系 (5条):                              │
│   → 包含节: 1.1 集合的概念                   │
│   → 包含节: 1.2 集合的运算                   │
│   → 关联核心素养: 数学抽象                   │
│   ...                                       │
├─────────────────────────────────────────────┤
│ 审核操作:                                    │
│ ○ 通过  ○ 有问题                            │
│                                             │
│ 批注 (有问题时必填):                          │
│ ┌─────────────────────────────────────────┐ │
│ │ 标题不完整，应为"第一章 集合与常用逻辑...  │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│           [提交审核] [取消]                  │
└─────────────────────────────────────────────┘
```

## 三、数据流程设计

### 3.1 输入输出流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   原始数据   │ --> │  数据验证    │ --> │  导入系统   │
│  JSON文件   │     │  格式检查    │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                                              v
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  新版本数据  │ <-- │  审核汇总    │ <-- │  教师审核   │
│  JSON文件   │     │  生成报告    │     │  提交意见   │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 3.2 审核状态流转

```
待审核 (pending)
    │
    ├── 通过 ──> 已审核 (approved)
    │
    └── 有问题 ──> 待修正 (needs_fix)
                      │
                      └── 修正后 ──> 待审核 (pending)
```

## 四、数据结构设计

### 4.1 版本元数据

每个学科目录包含 `version.json`：

```json
{
  "version": "v1.1",
  "baseVersion": "v1",
  "createTime": "2026-01-22T10:00:00",
  "lastModified": "2026-01-22T15:30:00",
  "status": "in_review",
  "statistics": {
    "totalEntities": 403,
    "totalRelations": 2746,
    "reviewed": 247,
    "approved": 230,
    "needsFix": 17
  },
  "reviewers": [
    {
      "id": "teacher_001",
      "name": "张老师",
      "assignedTypes": ["Chapter", "Section"]
    }
  ]
}
```

### 4.2 审核记录

`review_records.json`：

```json
{
  "subjectId": "高中数学-v1",
  "records": [
    {
      "id": "review_20260122_001",
      "targetType": "entity",
      "targetId": "urn:jy:math:SB0201:OB06:Chapter:1",
      "targetTitle": "第一章 集合与常用逻辑用语",
      "field": "title",
      "originalValue": "第一章 集合",
      "suggestedValue": "第一章 集合与常用逻辑用语",
      "status": "approved",
      "reviewer": {
        "id": "teacher_001",
        "name": "张老师"
      },
      "comment": "标题不完整，已补充",
      "createTime": "2026-01-22T10:30:00",
      "resolveTime": "2026-01-22T11:00:00"
    },
    {
      "id": "review_20260122_002",
      "targetType": "relation",
      "sourceId": "urn:jy:math:...:Chapter:1",
      "targetId": "urn:jy:math:...:Section:1",
      "relationName": "chapterHasSection",
      "status": "approved",
      "reviewer": {
        "id": "teacher_001",
        "name": "张老师"
      },
      "comment": "",
      "createTime": "2026-01-22T10:35:00"
    }
  ]
}
```

### 4.3 审核汇总报告

`review_report.json`：

```json
{
  "subjectId": "高中数学-v1",
  "reportTime": "2026-01-22T16:00:00",
  "summary": {
    "totalReviewed": 500,
    "approved": 480,
    "needsFix": 20,
    "fixedCount": 15
  },
  "byType": {
    "Chapter": {"total": 20, "approved": 18, "needsFix": 2},
    "Section": {"total": 100, "approved": 95, "needsFix": 5}
  },
  "pendingFixes": [
    {
      "targetId": "urn:jy:math:...",
      "issue": "标题缺失",
      "priority": "high"
    }
  ]
}
```

## 五、技术实现方案

### 5.1 前端技术

- **框架**：纯HTML + JavaScript（无需复杂框架）
- **图谱可视化**：D3.js（复用现有代码）
- **表格组件**：简单HTML表格 + CSS样式
- **存储**：localStorage（本地）/ JSON文件（持久化）

### 5.2 后端API

基于现有的 `neo4j_query_api.py` 扩展：

```python
# 新增API端点
GET  /api/review/subjects           # 获取学科列表
GET  /api/review/entities/{subject} # 获取实体列表
GET  /api/review/relations/{subject}# 获取关系列表
POST /api/review/submit             # 提交审核结果
GET  /api/review/report/{subject}   # 获取审核报告
POST /api/review/export             # 导出修正后数据
```

### 5.3 文件结构

```
static/
├── review.html           # 审校主页面
├── review.js            # 审校逻辑
└── review.css           # 审校样式

src/
└── review_api.py        # 审校API服务

图谱数据/{学科}/
├── entities/
├── relations/
├── version.json         # 版本信息
└── review_records.json  # 审核记录
```

## 六、使用流程

### 6.1 管理员操作

1. 准备数据并运行规范化检查
2. 生成HTML图谱
3. 分配审核任务给教师
4. 汇总审核结果，生成新版本

### 6.2 教师操作

1. 访问审校平台，选择负责的学科
2. 按实体类型逐条审核
3. 标记问题并填写修改建议
4. 查看审核进度

### 6.3 命令行工具

```bash
# 初始化审核
python3 manage.py review init --subject 高中数学

# 查看审核进度
python3 manage.py review status --subject 高中数学

# 导出审核报告
python3 manage.py review report --subject 高中数学

# 应用审核修改，生成新版本
python3 manage.py review apply --subject 高中数学
```

## 七、后续扩展

### 7.1 第一阶段（当前）

- 基于文件的审核记录
- 单机使用
- 手动导出/导入

### 7.2 第二阶段

- 多用户协作
- 实时同步
- 权限管理

### 7.3 第三阶段

- 自动化数据验证
- AI辅助审核建议
- 版本对比可视化
