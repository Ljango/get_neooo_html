# æ•°æ®æ ¼å¼è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜çŸ¥è¯†å›¾è°±é¡¹ç›®æ”¯æŒçš„æ•°æ®æ–‡ä»¶æ ¼å¼ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
å›¾è°±æ•°æ®/
â””â”€â”€ {å­¦ç§‘ç›®å½•}/
    â”œâ”€â”€ entities/          # å®ä½“æ–‡ä»¶ç›®å½•
    â”‚   â”œâ”€â”€ EntityType1.json
    â”‚   â”œâ”€â”€ EntityType2.json
    â”‚   â””â”€â”€ ...
    â””â”€â”€ relations/         # å…³ç³»æ–‡ä»¶ç›®å½•
        â”œâ”€â”€ EntityType1_EntityType2_relations.json
        â””â”€â”€ ...
```

## ğŸ“Š å®ä½“æ–‡ä»¶æ ¼å¼

å®ä½“æ–‡ä»¶åº”æ”¾åœ¨ `entities/` ç›®å½•ä¸‹ï¼Œæ”¯æŒä¸¤ç§æ ¼å¼ï¼š

### æ ¼å¼1ï¼šç›´æ¥æ•°ç»„ï¼ˆæ¨èï¼‰

```json
[
  {
    "identifier": "urn:jy:math:2022:theme:integration-practice",
    "type": "Theme",
    "title": "ç»¼åˆä¸å®è·µ",
    "description": "ç»¼åˆä¸å®è·µæ˜¯æ•°å­¦å­¦ä¹ çš„é‡è¦æ–¹å¼",
    "properties": {
      "customField": "value"
    }
  },
  {
    "identifier": "urn:jy:math:2022:theme:number-operations",
    "type": "Theme",
    "title": "æ•°ä¸è¿ç®—",
    "description": "..."
  }
]
```

### æ ¼å¼2ï¼šåŒ…è£…å¯¹è±¡

```json
{
  "entities": [
    {
      "identifier": "urn:jy:math:2022:theme:integration-practice",
      "type": "Theme",
      "title": "ç»¼åˆä¸å®è·µ",
      "description": "..."
    }
  ]
}
```

## ğŸ”— å…³ç³»æ–‡ä»¶æ ¼å¼

å…³ç³»æ–‡ä»¶åº”æ”¾åœ¨ `relations/` ç›®å½•ä¸‹ï¼Œæ”¯æŒä¸‰ç§æ ¼å¼ï¼š

### æ ¼å¼1ï¼šç›´æ¥æ•°ç»„ï¼ˆæ¨èï¼‰

```json
[
  {
    "relationName": "themeHasChapter",
    "label": "/hasChapter",
    "source": "urn:jy:math:2022:theme:integration-practice",
    "target": "urn:jy:math:2022:chapter:s4:sp:sampling-data-analysis:G7B:chX:1"
  },
  {
    "relationName": "themeHasChapter",
    "label": "/hasChapter",
    "source": "urn:jy:math:2022:theme:integration-practice",
    "target": "urn:jy:math:2022:chapter:s4:na:equations-inequalities:G7B:chX:1"
  }
]
```

### æ ¼å¼2ï¼šä½¿ç”¨ "relations" é”®

```json
{
  "relations": [
    {
      "relationName": "themeHasChapter",
      "label": "/hasChapter",
      "source": "urn:jy:math:2022:theme:integration-practice",
      "target": "urn:jy:math:2022:chapter:s4:sp:sampling-data-analysis:G7B:chX:1"
    }
  ]
}
```

### æ ¼å¼3ï¼šä½¿ç”¨ "relationships" é”®

```json
{
  "relationships": [
    {
      "relationName": "themeHasChapter",
      "label": "/hasChapter",
      "source": "urn:jy:math:2022:theme:integration-practice",
      "target": "urn:jy:math:2022:chapter:s4:sp:sampling-data-analysis:G7B:chX:1"
    }
  ]
}
```

## ğŸ“ å…³ç³»å¯¹è±¡å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `relationName` | string | âœ… | å…³ç³»ç±»å‹åç§°ï¼Œå¦‚ "themeHasChapter" |
| `label` | string | âœ… | å…³ç³»æ˜¾ç¤ºæ ‡ç­¾ï¼Œå¦‚ "/hasChapter" |
| `source` | string | âœ… | æºå®ä½“çš„ identifier |
| `target` | string | âœ… | ç›®æ ‡å®ä½“çš„ identifier |
| `properties` | object | âŒ | å…³ç³»çš„é¢å¤–å±æ€§ï¼ˆå¯é€‰ï¼‰ |

## ğŸ”§ æ•°æ®è°ƒæ•´æŒ‡å—

å¦‚æœæ‚¨çš„æ•°æ®æ–‡ä»¶æ ¼å¼ä¸è¢«æ”¯æŒï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼è°ƒæ•´ï¼š

### æƒ…å†µ1ï¼šå…³ç³»æ–‡ä»¶ä½¿ç”¨å…¶ä»–é”®å

å¦‚æœæ‚¨çš„æ–‡ä»¶æ ¼å¼æ˜¯ï¼š
```json
{
  "data": [...],
  "links": [...],
  "edges": [...]
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å°†é”®åæ”¹ä¸º `relations` æˆ– `relationships`
2. æˆ–è€…å°†æ•°æ®æå–ä¸ºç›´æ¥æ•°ç»„æ ¼å¼

### æƒ…å†µ2ï¼šå…³ç³»å¯¹è±¡ç¼ºå°‘å¿…éœ€å­—æ®µ

å¦‚æœå…³ç³»å¯¹è±¡ç¼ºå°‘ `relationName`ã€`label`ã€`source`ã€`target` å­—æ®µï¼š

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ¯ä¸ªå…³ç³»å¯¹è±¡éƒ½åŒ…å«è¿™äº›å­—æ®µ
- å¯ä»¥ä»æ–‡ä»¶åæ¨æ–­ `relationName`ï¼Œä½†å»ºè®®åœ¨æ•°æ®ä¸­æ˜ç¡®æŒ‡å®š

### æƒ…å†µ3ï¼šå®ä½“æ–‡ä»¶æ ¼å¼ä¸æ ‡å‡†

å¦‚æœå®ä½“æ–‡ä»¶æ—¢ä¸æ˜¯æ•°ç»„ï¼Œä¹Ÿä¸æ˜¯ `{"entities": [...]}` æ ¼å¼ï¼š

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°†æ•°æ®åŒ…è£…ä¸ºæ•°ç»„æ ¼å¼ï¼š`[...]`
- æˆ–åŒ…è£…ä¸ºå¯¹è±¡æ ¼å¼ï¼š`{"entities": [...]}`

## âœ… æ ¼å¼éªŒè¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥éªŒè¯æ•°æ®æ ¼å¼ï¼š

```bash
# æµ‹è¯•åŠ è½½æŒ‡å®šå­¦ç§‘çš„æ•°æ®
python3 -c "
import sys
sys.path.insert(0, 'src')
from neo4j_importer import Neo4jImporter

importer = Neo4jImporter('ä¹‰æ•™æ•°å­¦', '.env')
entities = importer.load_entities()
relations = importer.load_relations()
print(f'å®ä½“: {sum(len(v) for v in entities.values())} ä¸ª')
print(f'å…³ç³»: {len(relations)} ä¸ª')
"
```

## ğŸ“Œ æœ€ä½³å®è·µ

1. **ç»Ÿä¸€æ ¼å¼**ï¼šå»ºè®®æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„æ ¼å¼ï¼ˆæ¨èç›´æ¥æ•°ç»„æ ¼å¼ï¼‰
2. **æ–‡ä»¶å‘½å**ï¼šå…³ç³»æ–‡ä»¶å»ºè®®ä½¿ç”¨ `{SourceType}_{TargetType}_relations.json` æ ¼å¼
3. **å­—æ®µå®Œæ•´**ï¼šç¡®ä¿æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å­˜åœ¨
4. **ç¼–ç ç»Ÿä¸€**ï¼šæ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç 

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæœ‰äº›å…³ç³»æ–‡ä»¶æ˜¾ç¤º"æ ¼å¼ä¸æ”¯æŒ"ï¼Ÿ

A: å¯èƒ½çš„åŸå› ï¼š
1. æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼
2. æ–‡ä»¶æ—¢ä¸æ˜¯æ•°ç»„ï¼Œä¹Ÿä¸æ˜¯åŒ…å« `relations`/`relationships` é”®çš„å¯¹è±¡
3. æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼Œç¡®ä¿ç¬¦åˆä¸Šè¿°ä¸‰ç§æ ¼å¼ä¹‹ä¸€ã€‚

### Q: å¦‚ä½•æ‰¹é‡è½¬æ¢å…³ç³»æ–‡ä»¶æ ¼å¼ï¼Ÿ

A: å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Python è„šæœ¬ï¼š

```python
import json
from pathlib import Path

# è½¬æ¢å•ä¸ªæ–‡ä»¶
def convert_relations_file(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    # å¦‚æœå·²ç»æ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å›
    if isinstance(data, list):
        return data
    
    # å¦‚æœæ˜¯å¯¹è±¡ï¼Œæå–å…³ç³»æ•°ç»„
    if isinstance(data, dict):
        # å°è¯•ä¸åŒçš„é”®å
        for key in ['relations', 'relationships', 'data', 'links', 'edges']:
            if key in data and isinstance(data[key], list):
                return data[key]
    
    return []

# æ‰¹é‡è½¬æ¢
relations_dir = Path('å›¾è°±æ•°æ®/ä¹‰æ•™æ•°å­¦_1231/relations')
for file in relations_dir.glob('*.json'):
    relations = convert_relations_file(file)
    # ä¿å­˜ä¸ºæ ‡å‡†æ ¼å¼
    with open(file, 'w', encoding='utf-8') as f:
        json.dump(relations, f, ensure_ascii=False, indent=2)
```
