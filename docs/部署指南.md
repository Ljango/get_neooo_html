# 知识图谱数据审校系统 - 部署指南

## 一、系统要求

- Docker 20.10+
- Docker Compose 2.0+
- 内存：至少 2GB
- 磁盘：至少 10GB

## 二、快速部署

### 1. 克隆项目

```bash
git clone <repository-url>
cd get_neooo_html
```

### 2. 配置环境变量

```bash
cd docker
cp env.example .env
```

编辑 `.env` 文件，设置：
- `MYSQL_ROOT_PASSWORD` - MySQL root密码
- `MYSQL_PASSWORD` - 应用数据库密码
- `JWT_SECRET_KEY` - JWT签名密钥（至少32字符）

### 3. 启动服务

基础模式（MySQL + FastAPI）：
```bash
docker-compose up -d
```

生产模式（包含Nginx）：
```bash
docker-compose --profile production up -d
```

包含Neo4j：
```bash
docker-compose --profile with-neo4j up -d
```

### 4. 访问系统

- 应用地址：http://localhost:8000
- API文档：http://localhost:8000/docs
- 默认账号：`root` / `root123`

## 三、本地开发

### 1. 安装依赖

```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置数据库

在 `.env` 文件中配置MySQL连接：
```
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=knowledge_graph
JWT_SECRET_KEY=your-secret-key
```

### 3. 启动开发服务器

```bash
python server.py --reload --port 8000
```

## 四、服务管理

### 查看日志
```bash
# 所有服务
docker-compose logs -f

# 单个服务
docker-compose logs -f app
docker-compose logs -f mysql
```

### 重启服务
```bash
docker-compose restart app
```

### 停止服务
```bash
docker-compose down
```

### 清理数据（危险）
```bash
docker-compose down -v  # 删除数据卷
```

## 五、数据备份

### 备份MySQL
```bash
docker exec kg-mysql mysqldump -u root -p knowledge_graph > backup.sql
```

### 恢复MySQL
```bash
cat backup.sql | docker exec -i kg-mysql mysql -u root -p knowledge_graph
```

## 六、常见问题

### Q: 登录失败显示"用户名或密码错误"
A: 检查数据库是否正确初始化，或尝试重置root密码

### Q: 数据操作按钮不可见
A: 只有root角色可以看到系统管理页面，请确认登录账号权限

### Q: API响应缓慢
A: 检查MySQL连接，确保数据库服务运行正常

### Q: 静态文件404
A: 确保static目录正确挂载到容器

## 七、安全建议

1. **修改默认密码**：首次登录后立即修改root密码
2. **更新JWT密钥**：使用强随机字符串作为JWT_SECRET_KEY
3. **限制端口访问**：生产环境只暴露必要端口（80/443）
4. **启用HTTPS**：配置SSL证书，使用Nginx反向代理
5. **定期备份**：设置自动备份MySQL数据
