# 配置说明

## 环境变量

### 数据库配置

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `MYSQL_HOST` | `localhost` | MySQL主机地址 |
| `MYSQL_PORT` | `3306` | MySQL端口 |
| `MYSQL_USER` | - | MySQL用户名 |
| `MYSQL_PASSWORD` | - | MySQL密码 |
| `MYSQL_DATABASE` | - | 数据库名称 |

### Neo4j配置

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `NEO4J_URI` | `bolt://localhost:7687` | Neo4j连接URI |
| `NEO4J_USER` | `neo4j` | Neo4j用户名 |
| `NEO4J_PASSWORD` | - | Neo4j密码 |
| `DB_SCHEME` | `bolt` | 连接协议 |
| `DB_HOST` | `localhost` | Neo4j主机 |
| `DB_PORT` | `7687` | Neo4j端口 |
| `DB_NAME` | - | 数据库名称 |

### JWT配置

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `JWT_SECRET` | 自动生成 | JWT签名密钥 |
| `JWT_EXPIRE_HOURS` | `24` | Token过期时间(小时) |

## 配置文件

### `src/config.py`

主配置文件，包含：

- **路径配置**: `PROJECT_ROOT`, `DATA_ROOT`, `STATIC_ROOT`
- **学科配置**: `SUBJECT_CONFIG` - 自动检测最新版本数据目录
- **实体类型配置**: `ENTITY_TYPE_CONFIG` - 节点颜色、大小等
- **实体排序配置**: `ENTITY_TYPE_ORDER` - 审核页面排序

### 热更新配置

无需重启服务即可更新配置：

1. 添加新的数据版本目录（如 `义教生物-v5`）
2. 通过 "系统管理 → 刷新配置" 触发重新检测
3. 系统自动使用最新版本

代码实现：
```python
from config import refresh_subject_config, list_available_subjects

# 刷新配置
new_config = refresh_subject_config()

# 列出当前配置
subjects = list_available_subjects()
```

### API端点

```
POST /api/admin/config/refresh  # 刷新配置（需管理员权限）
GET  /api/admin/config/subjects # 查看学科配置
```

## 学科配置结构

```python
{
    "高中物理": {
        "icon": "⚛️",           # 显示图标
        "display_name": "高中物理",  # 显示名称
        "data_dir": "高中物理-v3",   # 数据目录（自动检测）
        "files": ["高中物理_课标.html"],  # 关联HTML文件
        "color": "#e74c3c",     # 主题色
        "neo4j_label": "GaoZhongWuLi"  # Neo4j标签
    },
    ...
}
```

## 配置验证

使用配置验证函数检查配置完整性：

```python
from config import validate_config, print_config_status

# 验证配置
is_valid, errors = validate_config()
if not is_valid:
    for err in errors:
        print(f"配置错误: {err}")

# 打印配置状态
print_config_status()
```

## 注意事项

1. 敏感配置（密码等）不要提交到版本控制
2. 生产环境建议使用环境变量而非配置文件
3. 修改 `SUBJECT_CONFIG` 后调用 `refresh_subject_config()` 生效
4. 数据库配置修改需重启服务
