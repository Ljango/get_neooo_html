# 知识图谱项目架构说明

## 📁 项目结构（整合后）

```
get_neooo_html/
├── manage.py                    # 🆕 统一管理入口（推荐使用）
├── src/
│   ├── config.py               # 🆕 统一配置文件
│   ├── graph_generator.py      # 核心：图谱生成器
│   ├── generate_subject_graphs.py  # 生成所有学科图谱
│   ├── update_index.py         # 更新导航页面
│   └── start_server.py         # 启动HTTP服务器
├── templates/
│   └── graph_template.html     # 🆕 HTML模板文件
├── static/                      # 生成的HTML文件
├── 图谱数据/                    # 原始数据
└── import_data.py              # 导入数据到Neo4j

```

## 🔄 文件关系

### 核心模块
- **config.py** - 统一配置中心
  - 路径配置（PROJECT_ROOT, DATA_ROOT等）
  - 实体类型配置（ENTITY_TYPE_CONFIG）
  - 学科配置（SUBJECT_CONFIG）
  - 服务器配置

- **graph_generator.py** - 图谱生成核心
  - GraphGenerator类：加载数据、生成HTML、生成Neo4j脚本
  - 使用templates/graph_template.html模板

### 业务脚本
- **generate_subject_graphs.py** - 批量生成图谱
  - 调用GraphGenerator生成各学科图谱
  - 包含各学科的生成函数

- **update_index.py** - 生成导航页面
  - 扫描static目录下的HTML文件
  - 自动生成index.html导航页面

- **start_server.py** - 启动本地服务器
  - 启动HTTP服务器查看图谱

- **import_data.py** - 数据导入
  - 将JSON数据导入到Neo4j数据库

### 统一入口
- **manage.py** - 命令行管理工具（🆕推荐）
  - 整合所有功能的统一入口
  - 提供简洁的命令行接口

## 🚀 使用方法

### 方式1：使用统一管理工具（推荐）

```bash
# 列出所有可用学科
python3 manage.py list

# 生成指定学科图谱
python3 manage.py generate --subject 义教数学

# 生成所有学科图谱
python3 manage.py generate --all

# 更新导航页面
python3 manage.py update-index

# 启动HTTP服务器
python3 manage.py serve
python3 manage.py serve --port 8080
```

### 方式2：使用原有脚本

```bash
# 生成图谱
python3 -c "import sys; sys.path.insert(0, 'src'); from generate_subject_graphs import generate_math_graph; generate_math_graph()"

# 更新导航页面
python3 src/update_index.py

# 启动服务器
python3 src/start_server.py
```

## 🎯 整合优势

### 1. 消除重复代码
**整合前**：
- 路径配置在4个文件中重复定义
- ENTITY_TYPE_CONFIG在graph_generator.py中
- SUBJECT_CONFIG在update_index.py中

**整合后**：
- 所有配置集中在config.py
- 各模块通过import引用
- 代码量减少约100行

### 2. 统一入口
**整合前**：
- 需要记住多个脚本路径和命令
- 需要手动调整sys.path

**整合后**：
- 单一入口：`manage.py`
- 清晰的子命令结构
- 内置帮助文档

### 3. 更易维护
**整合前**：
- 修改配置需要编辑多个文件
- 添加新学科需要更新多处

**整合后**：
- 只需在config.py中添加配置
- 自动同步到所有模块

### 4. 更好的代码组织
**整合前**：
- HTML模板硬编码在Python中（700+行）
- 业务逻辑和模板混合

**整合后**：
- HTML模板独立存储
- 逻辑和视图分离
- 符合MVC模式

## 📊 代码量对比

| 文件 | 整合前 | 整合后 | 减少 |
|------|--------|--------|------|
| graph_generator.py | 1200行 | 452行 | -748行 |
| 配置代码 | 分散4个文件 | config.py 150行 | 集中管理 |
| 总代码量 | ~2500行 | ~2000行 | -500行 |

## 🔧 工作流程

### 完整流程
```bash
# 1. 准备数据（放在图谱数据/目录下）
# 2. 生成图谱
python3 manage.py generate --all

# 3. 更新导航页面
python3 manage.py update-index

# 4. 启动服务器查看
python3 manage.py serve
```

### 快速添加新学科

1. 在 `config.py` 的 `SUBJECT_CONFIG` 中添加配置：
```python
"义教英语": {
    "icon": "📖",
    "display_name": "义教英语",
    "data_dir": "义教英语_数据目录",
    "files": ["义教英语_课标.html"],
    "color": "#3498db"
}
```

2. 运行生成命令：
```bash
python3 manage.py generate --subject 义教英语
python3 manage.py update-index
```

完成！

## 📝 后续优化建议

1. **添加日志系统**：使用logging模块替代print
2. **添加测试**：为核心模块添加单元测试
3. **配置验证**：添加配置文件的验证逻辑
4. **进度显示**：为长时间任务添加进度条
5. **错误处理**：更详细的错误信息和恢复机制
