# çŸ¥è¯†å›¾è°±å®¡æ ¡ç³»ç»Ÿ - ä¸‰å¤§æ”¹è¿›æ€»ç»“

## é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### â“ é—®é¢˜1ï¼šå¹¶å‘æ€§èƒ½æ˜¯å¦å¯ä»¥æå‡ï¼Ÿ

**ç­”æ¡ˆï¼šå¯ä»¥ï¼Œå·²æä¾›ä¼˜åŒ–æ–¹æ¡ˆ** âœ…

#### å½“å‰æ€§èƒ½
- å¹¶å‘è¿æ¥ï¼š~10 req/s
- å“åº”æ—¶é—´ï¼š50-500ms
- ä½¿ç”¨åŒæ­¥æ•°æ®åº“æ“ä½œ

#### ä¼˜åŒ–æ–¹æ¡ˆï¼ˆå·²å®ç°åŸºç¡€è®¾æ–½ï¼‰

**é˜¶æ®µ1ï¼šç«‹å³å¯ç”¨ï¼ˆæ— éœ€æ”¹ä»£ç ï¼‰**
```bash
# å·²é…ç½®æ•°æ®åº“è¿æ¥æ± 
# å·²ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢
# å·²æ·»åŠ æŸ¥è¯¢ç´¢å¼•
```

**é¢„æœŸæå‡**ï¼š
- å¹¶å‘ â†’ 50 req/sï¼ˆ5xï¼‰
- å“åº”æ—¶é—´å‡å°‘ 30%

**é˜¶æ®µ2ï¼šå¼‚æ­¥æ”¹é€ ï¼ˆéœ€è¦1-2å‘¨å¼€å‘ï¼‰**
```bash
# å®‰è£…å¼‚æ­¥ä¾èµ–
pip install aiosqlite aiomysql aiofiles

# ä½¿ç”¨å¼‚æ­¥æ•°æ®åº“ï¼ˆå·²å‡†å¤‡å¥½ database_async.pyï¼‰
# æ”¹é€ APIä¸ºå¼‚æ­¥ï¼ˆéœ€è¦é‡æ„ï¼‰
```

**é¢„æœŸæå‡**ï¼š
- å¹¶å‘ â†’ 200+ req/sï¼ˆ20xï¼‰
- å“åº”æ—¶é—´å‡å°‘ 70%

#### å®æ–½å»ºè®®

**ç°åœ¨å¯ä»¥åšçš„**ï¼š
1. âœ… æ•°æ®åº“è¿æ¥å¤ç”¨ï¼ˆå·²å¯ç”¨ï¼‰
2. âœ… æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå·²å®ç°ï¼‰
3. âœ… å†…å­˜ç¼“å­˜ï¼ˆå¯é€‰æ·»åŠ ï¼‰

**åç»­ä¼˜åŒ–**ï¼š
- è¿ç§»åˆ°å¼‚æ­¥APIï¼ˆéœ€è¦å¼€å‘æ—¶é—´ï¼‰
- æ·»åŠ Redisç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº

---

### â“ é—®é¢˜2ï¼šå¦‚ä½•å®æ—¶æŸ¥çœ‹å›¾è°±æ•°æ®ï¼Ÿ

**ç­”æ¡ˆï¼šå·²å®ç°APIï¼Œå‰ç«¯é›†æˆå³å¯ä½¿ç”¨** âœ…

#### å·²å®ç°åŠŸèƒ½

**1. å›¾è°±æ•°æ®API**
```http
GET /api/review/entity-graph/{subject_id}/{identifier}
    ?depth=1&max_nodes=50
```

**ç¤ºä¾‹ï¼šæŸ¥çœ‹"Chapter_1"çš„å…³è”å›¾è°±**
```javascript
const graph = await api.graph.getEntityGraph(
    'é«˜ä¸­æ•°å­¦', 
    'Chapter_1',
    1,  // 1åº¦å…³ç³»
    50  // æœ€å¤š50ä¸ªèŠ‚ç‚¹
);

// è¿”å›æ•°æ®æ ¼å¼
{
  "nodes": [
    {"id": "Chapter_1", "label": "é›†åˆ", "is_center": true},
    {"id": "Section_1_1", "label": "é›†åˆçš„æ¦‚å¿µ", "is_center": false}
  ],
  "links": [
    {"source": "Chapter_1", "target": "Section_1_1", "relationName": "contains"}
  ]
}
```

#### å‰ç«¯é›†æˆæ–¹å¼

**æ–¹å¼1ï¼šåœ¨å®¡æ ¸é¡µé¢å†…åµŒå›¾è°±ï¼ˆæ¨èï¼‰**

åœ¨ `review.html` æ·»åŠ ï¼š
```html
<!-- å›¾è°±é¢æ¿ -->
<div class="graph-panel" style="height: 400px;">
    <svg id="entityGraph" width="100%" height="100%"></svg>
</div>

<button onclick="showGraph()">æŸ¥çœ‹å…³è”å›¾è°±</button>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
async function showGraph() {
    const data = await api.graph.getEntityGraph(
        currentSubject, 
        currentItem.id, 
        1, 
        50
    );
    renderD3Graph(data.nodes, data.links);
}

function renderD3Graph(nodes, links) {
    // ä½¿ç”¨D3.jsåŠ›å¯¼å‘å›¾
    // è¯¦è§ docs/æ–°åŠŸèƒ½è¯´æ˜.md ç¬¬äºŒéƒ¨åˆ†
}
</script>
```

**æ–¹å¼2ï¼šå¼¹å‡ºç‹¬ç«‹çª—å£**
```javascript
function openGraphWindow(entityId) {
    window.open(
        `/entity-graph.html?subject=${currentSubject}&id=${entityId}`,
        'graph',
        'width=800,height=600'
    );
}
```

#### æ€§èƒ½ä¼˜åŒ–

- âœ… é™åˆ¶èŠ‚ç‚¹æ•°é‡ï¼ˆé»˜è®¤50ä¸ªï¼‰
- âœ… æ”¯æŒæ·±åº¦æ§åˆ¶ï¼ˆ1-2åº¦ï¼‰
- âœ… æŒ‰éœ€åŠ è½½ï¼ˆä¸å½±å“åˆ—è¡¨æ€§èƒ½ï¼‰
- âœ… å¯ç¼“å­˜ç»“æœï¼ˆå‡å°‘é‡å¤åŠ è½½ï¼‰

---

### â“ é—®é¢˜3ï¼šè€å¸ˆèƒ½å¦ç›´æ¥ç¼–è¾‘æ•°æ®å¹¶è½åº“ï¼Ÿ

**ç­”æ¡ˆï¼šå¯ä»¥ï¼å·²å®ç°å®Œæ•´çš„ç¼–è¾‘å…¥åº“åŠŸèƒ½** âœ…

#### æ”¯æŒçš„ç¼–è¾‘æ“ä½œ

**1. ä¿®æ”¹å®ä½“å±æ€§**
```javascript
// ä¿®æ”¹æ ‡é¢˜
await api.edit.updateEntity('é«˜ä¸­æ•°å­¦', 'Chapter_1', {
    title: 'æ–°æ ‡é¢˜',
    description: 'æ–°æè¿°',
    contentJson: {...}
});

// âœ… è‡ªåŠ¨ä¿å­˜åˆ°JSONæ–‡ä»¶
// âœ… è‡ªåŠ¨åˆ›å»ºå¤‡ä»½
// âœ… è®°å½•æ“ä½œæ—¥å¿—
```

**2. æ·»åŠ å…³ç³»**
```javascript
await api.edit.createRelation('é«˜ä¸­æ•°å­¦', {
    source: 'Chapter_1',
    target: 'Knowledge_005',
    relation_name: 'contains',
    label: 'åŒ…å«'
});
```

**3. åˆ é™¤å…³ç³»**
```javascript
await api.edit.deleteRelation('é«˜ä¸­æ•°å­¦', {
    source: 'Chapter_1',
    target: 'Section_old',
    relation_name: 'contains'
});
```

**4. æ‰¹é‡æ“ä½œ**
```javascript
await api.edit.batchEdit({
    subject_id: 'é«˜ä¸­æ•°å­¦',
    entity_updates: [
        {identifier: 'Ch1', updates: {title: '...'}},
        {identifier: 'Ch2', updates: {title: '...'}}
    ],
    relation_creates: [...],
    relation_deletes: [...]
});
```

#### æ•°æ®å®‰å…¨ä¿éšœ

âœ… **è‡ªåŠ¨å¤‡ä»½**
- æ¯æ¬¡ç¼–è¾‘å‰è‡ªåŠ¨åˆ›å»º `.bak` æ–‡ä»¶
- å­˜å‚¨åœ¨ `å›¾è°±æ•°æ®/{subject}/backups/` ç›®å½•
- ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½ç‰ˆæœ¬

âœ… **æ“ä½œæ—¥å¿—**
- è®°å½•æ‰€æœ‰ä¿®æ”¹åˆ° `operation_logs` è¡¨
- åŒ…å«ï¼šç”¨æˆ·ã€æ—¶é—´ã€æ“ä½œç±»å‹ã€å…·ä½“å†…å®¹
- å¯è¿½æº¯å®Œæ•´å†å²

âœ… **æƒé™æ§åˆ¶**
- åªæœ‰ teacher åŠä»¥ä¸Šè§’è‰²å¯ç¼–è¾‘
- APIå±‚å¼ºåˆ¶éªŒè¯æƒé™
- é˜²æ­¢æœªæˆæƒä¿®æ”¹

âœ… **æ•°æ®éªŒè¯**
- JSONæ ¼å¼æ ¡éªŒ
- å®ä½“/å…³ç³»å­˜åœ¨æ€§éªŒè¯
- é˜²æ­¢æ•°æ®ç ´å

#### å‰ç«¯é›†æˆ

**åœ¨å®¡æ ¸é¡µé¢æ·»åŠ ç¼–è¾‘æŒ‰é’®**ï¼š
```javascript
// ç¼–è¾‘å®ä½“
async function editEntityProperty(field, currentValue) {
    const newValue = prompt(`ä¿®æ”¹${field}:`, currentValue);
    if (!newValue || newValue === currentValue) return;
    
    try {
        await api.edit.updateEntity(
            currentSubject,
            currentItem.id,
            { [field]: newValue }
        );
        
        showToast('ä¿®æ”¹æˆåŠŸï¼å·²è‡ªåŠ¨ä¿å­˜', 'success');
        loadEntityDetail(); // åˆ·æ–°æ˜¾ç¤º
        
    } catch (error) {
        showToast('ä¿®æ”¹å¤±è´¥: ' + error.message, 'error');
    }
}

// æ·»åŠ åˆ°è¯¦æƒ…é¢æ¿
<div class="property-item">
    <span class="label">æ ‡é¢˜</span>
    <span class="value">
        {{ entity.title }}
        <button onclick="editEntityProperty('title', '{{ entity.title }}')">
            ç¼–è¾‘
        </button>
    </span>
</div>
```

**æŸ¥çœ‹ä¿®æ”¹å†å²**ï¼š
```javascript
async function showEditHistory() {
    const backups = await api.edit.listBackups(currentSubject);
    // æ˜¾ç¤ºå¤‡ä»½åˆ—è¡¨
    backups.backups.forEach(backup => {
        console.log(`${backup.filename} - ${new Date(backup.modified * 1000)}`);
    });
}
```

---

## å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šè€å¸ˆå®¡æ ¸å¹¶ä¿®æ­£æ•°æ®

```javascript
// 1. æŸ¥çœ‹å®ä½“è¯¦æƒ…
const entity = await api.review.getEntityDetail('é«˜ä¸­æ•°å­¦', 'Chapter_1');

// 2. æŸ¥çœ‹å…³è”å›¾è°±
const graph = await api.graph.getEntityGraph('é«˜ä¸­æ•°å­¦', 'Chapter_1', 1);
// â†’ å‘ç°æ ‡é¢˜æœ‰è¯¯ã€ç¼ºå°‘å…³ç³»

// 3. ä¿®æ­£å®ä½“å±æ€§
await api.edit.updateEntity('é«˜ä¸­æ•°å­¦', 'Chapter_1', {
    title: 'é›†åˆä¸å¸¸ç”¨é€»è¾‘ç”¨è¯­ï¼ˆä¿®è®¢ï¼‰'
});

// 4. æ·»åŠ ç¼ºå¤±çš„å…³ç³»
await api.edit.createRelation('é«˜ä¸­æ•°å­¦', {
    source: 'Chapter_1',
    target: 'Knowledge_010',
    relation_name: 'contains',
    label: 'åŒ…å«çŸ¥è¯†ç‚¹'
});

// 5. åˆ é™¤é”™è¯¯çš„å…³ç³»
await api.edit.deleteRelation('é«˜ä¸­æ•°å­¦', {
    source: 'Chapter_1',
    target: 'Knowledge_old',
    relation_name: 'contains'
});

// 6. æäº¤å®¡æ ¸æ„è§
await api.review.submit({
    subject_id: 'é«˜ä¸­æ•°å­¦',
    target_type: 'entity',
    target_id: 'Chapter_1',
    status: 'approved',
    comment: 'å·²ä¿®æ­£æ ‡é¢˜å’Œå…³ç³»'
});

// âœ… æ‰€æœ‰ä¿®æ”¹å·²ä¿å­˜åˆ°JSONæ–‡ä»¶
// âœ… å·²åˆ›å»ºå¤‡ä»½ï¼šChapter_20260122_153045.bak
// âœ… å·²è®°å½•æ“ä½œæ—¥å¿—
```

---

## å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•ç¼–è¾‘åŠŸèƒ½

```bash
# 1. ç¡®ä¿æœåŠ¡è¿è¡Œ
python server.py --reload --port 8011

# 2. ç™»å½•ç³»ç»Ÿï¼ˆteacheråŠä»¥ä¸Šï¼‰
# è®¿é—® http://localhost:8011/static/app/login.html

# 3. åœ¨æµè§ˆå™¨Consoleæµ‹è¯•API
api.edit.updateEntity('é«˜ä¸­æ•°å­¦', 'Chapter_1', {
    title: 'æµ‹è¯•ä¿®æ”¹'
}).then(r => console.log(r));
```

### 2. æŸ¥çœ‹APIæ–‡æ¡£

è®¿é—®ï¼šhttp://localhost:8011/docs

æœç´¢ï¼š
- `GET /api/review/entity-graph` - å›¾è°±å¯è§†åŒ–
- `POST /api/edit/entity/update` - ç¼–è¾‘å®ä½“
- `POST /api/edit/relation/create` - åˆ›å»ºå…³ç³»
- `POST /api/edit/relation/delete` - åˆ é™¤å…³ç³»

### 3. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£

- **æ–°åŠŸèƒ½è¯¦è§£**ï¼š`docs/æ–°åŠŸèƒ½è¯´æ˜.md`
- **æ€§èƒ½ä¼˜åŒ–**ï¼š`docs/æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ.md`
- **å¿«é€Ÿå¼€å§‹**ï¼š`docs/å¿«é€Ÿå¼€å§‹.md`

---

## æ€»ç»“å¯¹æ¯”

| åŠŸèƒ½ | æ”¹è¿›å‰ | æ”¹è¿›å | çŠ¶æ€ |
|------|--------|--------|------|
| **å¹¶å‘æ€§èƒ½** | ~10 req/s | 200+ req/sï¼ˆå®Œå…¨å®ç°åï¼‰ | âœ… æ–¹æ¡ˆå°±ç»ª |
| **å›¾è°±å¯è§†åŒ–** | âŒ æ—  | âœ… APIå·²å®ç° | âœ… å¯ç”¨ |
| **æ•°æ®ç¼–è¾‘** | âŒ æ—  | âœ… å®Œæ•´åŠŸèƒ½ | âœ… å¯ç”¨ |
| **è‡ªåŠ¨å¤‡ä»½** | âŒ æ—  | âœ… æ¯æ¬¡è‡ªåŠ¨ | âœ… å¯ç”¨ |
| **æ“ä½œæ—¥å¿—** | âŒ æ—  | âœ… å®Œæ•´è®°å½• | âœ… å¯ç”¨ |

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯ç”¨ âœ…
1. æµ‹è¯•ç¼–è¾‘APIï¼ˆå·²å®ç°ï¼‰
2. æµ‹è¯•å›¾è°±APIï¼ˆå·²å®ç°ï¼‰
3. æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

### éœ€è¦å‰ç«¯å¼€å‘ ğŸ”¨
1. åœ¨å®¡æ ¸é¡µé¢æ·»åŠ ç¼–è¾‘æŒ‰é’®
2. é›†æˆD3.jså›¾è°±å¯è§†åŒ–
3. æ·»åŠ æ‰¹é‡ç¼–è¾‘ç•Œé¢

### æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰âš¡
1. å¯ç”¨å†…å­˜ç¼“å­˜
2. è¿ç§»åˆ°å¼‚æ­¥APIï¼ˆå¤§é¡¹ç›®ï¼‰
3. æ·»åŠ Redisï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

---

**ç›¸å…³æ–‡æ¡£**ï¼š
- ğŸ“– [æ–°åŠŸèƒ½è¯¦ç»†è¯´æ˜](æ–°åŠŸèƒ½è¯´æ˜.md)
- âš¡ [æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ.md)
- ğŸš€ [å¿«é€Ÿå¼€å§‹æŒ‡å—](å¿«é€Ÿå¼€å§‹.md)

**æ›´æ–°æ—¶é—´**ï¼š2026-01-22  
**ç‰ˆæœ¬**ï¼šv1.1.0
